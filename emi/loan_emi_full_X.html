<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>‡¶ã‡¶£ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ì ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</title>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- QR Code JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3608304969182163"
     crossorigin="anonymous"></script>
<style>

/* ============================================
      GLOBAL STYLES
============================================ */
body { background:#eef1f5; }

/* Card */
.card {
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.12);
}

/* QR CODE COLUMN FIXED */
.qr-box {
    width:135px;
    height:135px;
    padding:6px;
    background:#fff;
    border-radius:8px;
    border:2px solid #444;
    margin:auto;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
}

/* Alerts */
.alert-custom {
    background:#ffe5e5;
    border-left:6px solid #d00;
    padding:12px;
    border-radius:6px;
}
.alert-success-custom {
    background:#e8ffe8;
    border-left:6px solid #0a0;
    padding:12px;
    border-radius:6px;
}

/* Graph Control */
.chart-container {
    height:180px !important;
    max-height:180px !important;
    padding:0 !important;
}

/* Footer */
footer {
    text-align:center;
    font-size:13px;
    opacity:0.75;
    margin:20px 0;
}

/* ============================================
      PRINT MODE
============================================ */
@media print {

    #inputSection, #actions, #topControls, .nav-tabs {
        display:none !important;
    }

    .card {
        border:1px solid #000;
        box-shadow:none;
    }

    /* shrink tables */
    .table-responsive {
        transform:scale(0.82);
        transform-origin:top left;
        width:120%;
    }

    table { font-size:11px !important; }
    th, td { padding:3px 5px !important; }

    footer {
        position:fixed;
        bottom:0;
        width:100%;
    }

    .chart-container { display:none !important; }
}
</style>
</head>

<body class="py-4">

<div class="container">

<!-- ============================================
      LANGUAGE + THEME
============================================ -->
<div id="topControls" class="d-flex justify-content-between align-items-center mb-3">

    <h1 id="mainTitle" class="fw-bold">‡¶ã‡¶£ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ì ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</h1>

    <div class="d-flex gap-3">

        <div class="btn-group">
            <button id="lang-bn" class="btn btn-sm btn-outline-primary active">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
            <button id="lang-en" class="btn btn-sm btn-outline-primary">English</button>
        </div>

        <div class="btn-group">
            <button id="theme-light" class="btn btn-sm btn-outline-secondary">üåï</button>
            <button id="theme-business" class="btn btn-sm btn-outline-secondary">üìä</button>
            <button id="theme-print" class="btn btn-sm btn-outline-secondary">üì∞</button>
        </div>

    </div>
</div>

<!-- ============================================
      INPUT SECTION
============================================ -->
<div id="inputSection" class="card p-4 mb-4">

    <h3 class="fw-bold">‡¶ã‡¶£‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h3>

    <div class="row g-3">

        <div class="col-md-6">
            <label class="fw-bold">‡¶ã‡¶£‡¶ó‡ßç‡¶∞‡¶π‡ßÄ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input id="name" class="form-control" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
        </div>

        <div class="col-md-6">
            <label class="fw-bold">‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
            <input id="loan" class="form-control" placeholder="100000">
        </div>

        <div class="col-md-4">
            <label class="fw-bold">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ (‡¶Æ‡¶æ‡¶∏)</label>
            <input id="months" class="form-control" placeholder="60">
        </div>

        <div class="col-md-4">
            <label class="fw-bold">‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (%)</label>
            <input id="rate" class="form-control" placeholder="13.40">
        </div>

        <div class="col-md-4">
            <label class="fw-bold">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶®‡ßá‡¶ü ‡¶¨‡ßá‡¶§‡¶®</label>
            <input id="salary" class="form-control" placeholder="0">
        </div>

        <div class="col-md-4">
            <label class="fw-bold">‡¶¨‡ßá‡¶§‡¶®‡ßá‡¶∞ ‡¶ï‡¶§ ‡¶∂‡¶§‡¶æ‡¶Ç‡¶∂ ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡ßç‡¶Ø?</label>
            <input id="salaryPercent" class="form-control" placeholder="80">
        </div>

    </div>

    <div class="text-center mt-4">
        <button onclick="calculateAll()" class="btn btn-primary btn-lg px-5">
            ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>

</div>

<!-- ============================================
      EMI TABS
============================================ -->
<ul class="nav nav-tabs">
    <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-ep">‡¶∏‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶® ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á</button>
    </li>
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-db">‡¶°‡¶ø‡¶ï‡ßç‡¶≤‡¶æ‡¶á‡¶®‡¶ø‡¶Ç ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á</button>
    </li>
</ul>

<div class="tab-content mt-3">

<!-- ===================================================
      EQUAL PRINCIPAL EMI TAB
==================================================== -->
<div class="tab-pane fade show active" id="tab-ep">

    <div id="results-ep"></div>

    <div id="chartContainerEP" class="card p-3 chart-container" style="display:none;">
        <canvas id="emiChartEP"></canvas>
    </div>

    <div id="schedule-ep"></div>
</div>

<!-- ===================================================
      DECLINING EMI TAB
==================================================== -->
<div class="tab-pane fade" id="tab-db">
    <div id="results-db"></div>
    <div id="schedule-db"></div>
</div>

</div>

<!-- Footer -->
<footer>¬© ablatif.com | latifshahin@gmail.com</footer>

<!-- Print Button -->
<div id="actions" class="text-center mt-3" style="display:none;">
    <button onclick="window.print()" class="btn btn-secondary">PDF / Print</button>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ===================================================
      UTIL
==================================================== */
function num(id){
    let v = document.getElementById(id).value.trim()
            || document.getElementById(id).placeholder.trim();
    return parseFloat(v) || 0;
}
function format(n){
    return Number(n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});
}

let currentLang="bn";
let chartEP = null;

/* LANGUAGE SWITCH */
document.getElementById("lang-bn").onclick = () => { currentLang="bn"; applyLang(); };
document.getElementById("lang-en").onclick = () => { currentLang="en"; applyLang(); };

function applyLang(){
    document.getElementById("mainTitle").innerText =
        currentLang==="bn" ? "‡¶ã‡¶£ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ì ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞"
                           : "Loan EMI & Eligibility Calculator";
}

/* THEME */
document.getElementById("theme-light").onclick=()=>document.body.className="theme-light";
document.getElementById("theme-business").onclick=()=>document.body.className="theme-business";
document.getElementById("theme-print").onclick=()=>document.body.className="theme-printlike";

/* ===================================================
      SMART MESSAGE
==================================================== */
function smartMessage(salaryPortion, monthlyInstall){
    let remaining = salaryPortion - monthlyInstall;
    let pct = (remaining / salaryPortion) * 100;

    if(pct < 5)
        return `<div class="alert-custom">
               ‚ö† <b>‡¶Ö‡¶§‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£!</b><br>
               ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø ‡¶™‡¶∞ ‡¶¨‡ßá‡¶§‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ <b>${pct.toFixed(1)}%</b> ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡ßá ‚Äî ‡¶ú‡ßÄ‡¶¨‡¶®‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶π‡¶§ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
            </div>`;

    if(pct < 15)
        return `<div class="alert-custom">
               ‚ö† <b>‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø ‡¶∞‡ßü‡ßá‡¶õ‡ßá!</b><br>
               ‡¶π‡¶æ‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡ßá <b>${pct.toFixed(1)}%</b> ‚Äî ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö ‡¶ö‡¶æ‡¶™ ‡¶∏‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
            </div>`;

    if(pct < 30)
        return `<div class="alert-success-custom">
               ‚úî <b>‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø</b><br>
               ‡¶π‡¶æ‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡ßá <b>${pct.toFixed(1)}%</b> ‚Äî ‡¶§‡¶¨‡ßá ‡¶∏‡¶û‡ßç‡¶ö‡ßü ‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
            </div>`;

    return `<div class="alert-success-custom">
               ‚úî <b>‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§!</b><br>
               ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø ‡¶™‡¶∞ ‡¶¨‡ßá‡¶§‡¶®‡ßá‡¶∞ <b>${pct.toFixed(1)}%</b> ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡ßá ‚Äî ‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø‡¶∂‡ßÄ‡¶≤‡•§
            </div>`;
}

/* ===================================================
      MAIN CALCULATOR
==================================================== */
function calculateAll(){

    let name = document.getElementById("name").value;
    let loan = num("loan");
    let months = num("months");
    let rate = num("rate")/100;
    let salary = num("salary");
    let salaryPercent = num("salaryPercent") || 80;

    let salaryPortion = salary * (salaryPercent/100);
    let r = (rate/12)*1.016666667;

    calcEP(name,loan,months,salaryPortion,salaryPercent,r);
    calcDB(name,loan,months,salaryPortion,salaryPercent,r);

    document.getElementById("actions").style.display="block";
}

/* ===================================================
      EQUAL PRINCIPAL EMI
==================================================== */
function calcEP(name,loan,months,salaryPortion,salaryPercent,r){

    let principal = loan/months;
    let bal = loan;
    let totalInterest=0;
    let data=[];

    for(let m=1;m<=months;m++){
        let interest = bal*r;
        totalInterest += interest;
        let close = bal - principal;
        data.push({month:m,open:bal,principal:principal,close:close,interest:interest});
        bal = close;
    }

    let monthlyInterest = totalInterest/months;
    let monthlyInstall = monthlyInterest + principal;

    let header = currentLang==="bn"
      ? `‡¶ã‡¶£‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ (‡¶∏‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®) ‚Äì ${format(loan)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ã‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø`
      : `Loan Summary (Equal Principal) ‚Äì For ${format(loan)} Tk`;

    /* Summary with 3 columns */
    document.getElementById("results-ep").innerHTML = `
    <div class="card p-4 mb-3 summary-card">

        <h3 class="fw-bold">${header}</h3>

        <div class="row mt-3">

            <div class="col-md-4">
                <p><strong>‡¶ã‡¶£‡¶ó‡ßç‡¶∞‡¶π‡ßÄ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${name || "N/A"}</p>
                <p><strong>‡¶¨‡ßá‡¶§‡¶®‡ßá‡¶∞ ${salaryPercent}%:</strong> ${format(salaryPortion)}</p>
                <p><strong>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®:</strong> ${format(principal)}</p>
            </div>

            <div class="col-md-4">
                <p><strong>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßÅ‡¶¶:</strong> ${format(totalInterest)}</p>
                <p><strong>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßÅ‡¶¶:</strong> ${format(monthlyInterest)}</p>
                <p><strong>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø:</strong> ${format(monthlyInstall)}</p>
            </div>

            <div class="col-md-4 text-center">
                <div class="qr-box" id="qrEP"></div>
            </div>

        </div>

        <div id="eligMsg" class="mt-3">
            ${ smartMessage(salaryPortion, monthlyInstall) }
        </div>

    </div>`;

    /* QR */
    new QRCode(document.getElementById("qrEP"),{
        text:"https://www.ablatif.com/emi/loan_emi_full.html",
        width:120, height:120
    });

    /* Graph */
    let labels=data.map(d=>d.month);
    let interestData=data.map(d=>d.interest);
    let principalData=data.map(d=>d.principal);

    if(chartEP) chartEP.destroy();

    document.getElementById("chartContainerEP").style.display="block";

    chartEP = new Chart(document.getElementById("emiChartEP"),{
        type:"line",
        data:{
            labels:labels,
            datasets:[
                {label:"‡¶∏‡ßÅ‡¶¶", data:interestData, borderColor:"red", borderWidth:2, tension:0.25},
                {label:"‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®", data:principalData, borderColor:"green", borderWidth:2, tension:0.25}
            ]
        },
        options:{ responsive:true, maintainAspectRatio:false }
    });

    /* EMI Schedule */
    let rows=""; let cumulative=0;

    for(let d of data){
        cumulative+=d.interest;
        let balInt = cumulative - monthlyInterest*d.month;

        rows+=`
        <tr>
            <td>${d.month}</td>
            <td>${format(d.open)}</td>
            <td>${format(d.principal)}</td>
            <td>${format(d.close)}</td>
            <td>${format(d.interest)}</td>
            <td>${format(monthlyInterest)}</td>
            <td>${format(cumulative)}</td>
            <td>${format(balInt)}</td>
        </tr>`;
    }

    document.getElementById("schedule-ep").innerHTML=`
    <div class="card p-4 page-break">

        <h4 class="fw-bold">‡¶∏‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶® - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>‡¶Æ‡¶æ‡¶∏</th>
                        <th>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®</th>
                        <th>‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®</th>
                        <th>‡¶∂‡ßá‡¶∑ ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®</th>
                        <th>‡¶∏‡ßÅ‡¶¶</th>
                        <th>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßÅ‡¶¶</th>
                        <th>‡¶∏‡¶Æ‡¶∑‡ßç‡¶ü‡¶ø‡¶ó‡¶§ ‡¶∏‡ßÅ‡¶¶</th>
                        <th>‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü</th>
                    </tr>
                </thead>
                <tbody>${rows}</tbody>
            </table>
        </div>

    </div>`;
}

/* ===================================================
      DECLINING EMI
==================================================== */
function calcDB(name,loan,months,salaryPortion,salaryPercent,r){

    let emi = loan*r*Math.pow(1+r,months)/(Math.pow(1+r,months)-1);

    let bal=loan, totalInterest=0, rows="";

    for(let m=1;m<=months;m++){
        let interest=bal*r;
        let principal=emi-interest;
        let close=bal-principal;
        totalInterest+=interest;

        rows+=`
        <tr>
            <td>${m}</td>
            <td>${format(bal)}</td>
            <td>${format(emi)}</td>
            <td>${format(interest)}</td>
            <td>${format(principal)}</td>
            <td>${format(close)}</td>
        </tr>`;

        bal=close;
    }

    let header=currentLang==="bn"
      ? `‡¶ã‡¶£‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ (‡¶°‡¶ø‡¶ï‡ßç‡¶≤‡¶æ‡¶á‡¶®‡¶ø‡¶Ç ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á) ‚Äì ${format(loan)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ã‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø`
      : `Loan Summary (Declining EMI) ‚Äì For ${format(loan)} Tk`;

    document.getElementById("results-db").innerHTML = `
    <div class="card p-4 mb-3">

        <h3 class="fw-bold">${header}</h3>

        <div class="row mt-3">
            <div class="col-md-4">
                <p><strong>‡¶®‡¶æ‡¶Æ:</strong> ${name}</p>
                <p><strong>‡¶¨‡ßá‡¶§‡¶® ‡¶Ö‡¶Ç‡¶∂ (${salaryPercent}%):</strong> ${format(salaryPortion)}</p>
                <p><strong>‡¶Æ‡ßá‡ßü‡¶æ‡¶¶:</strong> ${months} ‡¶Æ‡¶æ‡¶∏</p>
            </div>

            <div class="col-md-4">
                <p><strong>‡¶á‡¶è‡¶Æ‡¶Ü‡¶á:</strong> ${format(emi)}</p>
                <p><strong>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßÅ‡¶¶:</strong> ${format(totalInterest)}</p>
            </div>

            <div class="col-md-4 text-center">
                <!-- QR for DB optional -->
            </div>
        </div>

        ${ smartMessage(salaryPortion, emi) }

    </div>`;

    document.getElementById("schedule-db").innerHTML = `
    <div class="card p-4 page-break">
        <h4 class="fw-bold">‡¶°‡¶ø‡¶ï‡ßç‡¶≤‡¶æ‡¶á‡¶®‡¶ø‡¶Ç ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á - ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>‡¶Æ‡¶æ‡¶∏</th>
                        <th>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®</th>
                        <th>‡¶á‡¶è‡¶Æ‡¶Ü‡¶á</th>
                        <th>‡¶∏‡ßÅ‡¶¶</th>
                        <th>‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®</th>
                        <th>‡¶∂‡ßá‡¶∑</th>
                    </tr>
                </thead>
                <tbody>${rows}</tbody>
            </table>
        </div>

    </div>`;
}

</script>

</body>
</html>
