<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>‡¶ã‡¶£ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ì ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</title>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- QR Code JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3608304969182163"
     crossorigin="anonymous"></script>
<style>
/* ============================================
      GLOBAL STYLES
============================================ */
body { background:#eef1f5; }

/* Card */
.card {
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.12);
}

/* QR CODE COLUMN BOX */
.qr-box {
    width:135px;
    height:135px;
    padding:6px;
    background:#fff;
    border-radius:8px;
    border:2px solid #444;
    margin:auto;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
}

/* Alerts */
.alert-custom {
    background:#ffe5e5;
    border-left:6px solid #d00;
    padding:12px;
    border-radius:6px;
}
.alert-success-custom {
    background:#e8ffe8;
    border-left:6px solid #0a0;
    padding:12px;
    border-radius:6px;
}

/* Graph Control */
.chart-container {
    height:180px !important;
    max-height:180px !important;
    padding:0 !important;
}

/* Footer */
footer {
    text-align:center;
    font-size:13px;
    opacity:0.75;
    margin:20px 0;
}

/* Themes (light / business / printlike) */
body.theme-light  { background:#eef1f5; color:#212529; }
body.theme-business { background:#e3edf7; color:#111827; }
body.theme-printlike { background:#ffffff; color:#000000; }

/* ============================================
      PRINT MODE
============================================ */
@media print {

    #inputSection, #actions, #topControls, .nav-tabs {
        display:none !important;
    }

    .card {
        border:1px solid #000;
        box-shadow:none;
    }

    /* shrink tables */
    .table-responsive {
        transform:scale(0.82);
        transform-origin:top left;
        width:120%;
    }

    table { font-size:11px !important; }
    th, td { padding:3px 5px !important; }

    footer {
        position:fixed;
        bottom:0;
        width:100%;
    }

    .chart-container { display:none !important; }
}
</style>
</head>

<body class="py-4 theme-light">

<div class="container">
<!-- ============================================
      LANGUAGE + THEME CONTROL
============================================ -->
<div id="topControls" class="d-flex justify-content-between align-items-center mb-3">

    <h1 id="mainTitle" class="fw-bold">‡¶ã‡¶£ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ì ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</h1>

    <div class="d-flex gap-3">

        <!-- Language -->
        <div class="btn-group">
            <button id="lang-bn" class="btn btn-sm btn-outline-primary active">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
            <button id="lang-en" class="btn btn-sm btn-outline-primary">English</button>
        </div>

        <!-- Theme -->
        <div class="btn-group">
            <button id="theme-light" class="btn btn-sm btn-outline-secondary">üåï</button>
            <button id="theme-business" class="btn btn-sm btn-outline-secondary">üìä</button>
            <button id="theme-print" class="btn btn-sm btn-outline-secondary">üì∞</button>
        </div>
    </div>
</div>

<!-- ============================================
      INPUT SECTION (Bilingual Dynamic Labels)
============================================ -->
<div id="inputSection" class="card p-4 mb-4">

    <h3 id="inputTitle" class="fw-bold">‡¶ã‡¶£‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h3>

    <div class="row g-3">

        <!-- Borrower Name -->
        <div class="col-md-6">
            <label id="lblBorrower" class="fw-bold">‡¶ã‡¶£‡¶ó‡ßç‡¶∞‡¶π‡ßÄ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input id="name" class="form-control" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
        </div>

        <!-- Loan Amount -->
        <div class="col-md-6">
            <label id="lblAmount" class="fw-bold">‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
            <input id="loan" class="form-control" placeholder="100000">
        </div>

        <!-- Duration -->
        <div class="col-md-4">
            <label id="lblMonths" class="fw-bold">‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ (‡¶Æ‡¶æ‡¶∏)</label>
            <input id="months" class="form-control" placeholder="60">
        </div>

        <!-- Rate -->
        <div class="col-md-4">
            <label id="lblRate" class="fw-bold">‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (%)</label>
            <input id="rate" class="form-control" placeholder="13.40">
        </div>

        <!-- Salary -->
        <div class="col-md-4">
            <label id="lblSalary" class="fw-bold">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶®‡ßá‡¶ü ‡¶¨‡ßá‡¶§‡¶®</label>
            <input id="salary" class="form-control" placeholder="0">
        </div>

        <!-- Salary Percent -->
        <div class="col-md-4">
            <label id="lblSalaryPercent" class="fw-bold">‡¶¨‡ßá‡¶§‡¶®‡ßá‡¶∞ ‡¶ï‡¶§ ‡¶∂‡¶§‡¶æ‡¶Ç‡¶∂ ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡ßç‡¶Ø?</label>
            <input id="salaryPercent" class="form-control" placeholder="80">
        </div>

    </div>

    <div class="text-center mt-4">
        <button onclick="calculateAll()" class="btn btn-primary btn-lg px-5">
            ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>
</div>

<!-- ============================================
      EMI TABS
============================================ -->
<ul class="nav nav-tabs">
    <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-ep">
            ‡¶∏‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶® ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-db">
            ‡¶°‡¶ø‡¶ï‡ßç‡¶≤‡¶æ‡¶á‡¶®‡¶ø‡¶Ç ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á
        </button>
    </li>
</ul>

<div class="tab-content mt-3">

<!-- ===================================================
      EQUAL PRINCIPAL EMI TAB
==================================================== -->
<div class="tab-pane fade show active" id="tab-ep">

    <!-- Summary + QR will be inserted here -->
    <div id="results-ep"></div>

    <!-- Chart -->
    <div id="chartContainerEP" class="card p-3 chart-container" style="display:none;">
        <canvas id="emiChartEP"></canvas>
    </div>

    <!-- EMI Table -->
    <div id="schedule-ep"></div>
</div>

<!-- ===================================================
      DECLINING EMI TAB
==================================================== -->
<div class="tab-pane fade" id="tab-db">

    <!-- Summary -->
    <div id="results-db"></div>

    <!-- EMI Table -->
    <div id="schedule-db"></div>
</div>

</div>

<!-- ============================================
       FOOTER & PRINT BUTTON
============================================ -->
<footer>¬© ablatif.com | latifshahin@gmail.com</footer>

<div id="actions" class="text-center mt-3" style="display:none;">
    <button onclick="window.print()" class="btn btn-secondary">PDF / Print</button>
</div>
<script>
/* ===========================================================
    LANGUAGE DICTIONARY (Labels, placeholders, headings)
=========================================================== */
const lang = {
    bn: {
        title: "‡¶ã‡¶£ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ì ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞",
        inputTitle: "‡¶ã‡¶£‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø",

        borrower: "‡¶ã‡¶£‡¶ó‡ßç‡¶∞‡¶π‡ßÄ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ",
        amount: "‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£",
        months: "‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ (‡¶Æ‡¶æ‡¶∏)",
        rate: "‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (%)",
        salary: "‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶®‡ßá‡¶ü ‡¶¨‡ßá‡¶§‡¶®",
        salaryPercent: "‡¶¨‡ßá‡¶§‡¶®‡ßá‡¶∞ ‡¶ï‡¶§ ‡¶∂‡¶§‡¶æ‡¶Ç‡¶∂ ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡ßç‡¶Ø?",
        
        ph_borrower: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",
        ph_amount: "100000",
        ph_months: "60",
        ph_rate: "13.40",
        ph_salary: "0",
        ph_salaryPercent: "80",

        ep_title: amount => `‡¶ã‡¶£‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ (‡¶∏‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®) ‚Äì ${amount} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ã‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø`,
        db_title: amount => `‡¶ã‡¶£‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ (‡¶°‡¶ø‡¶ï‡ßç‡¶≤‡¶æ‡¶á‡¶®‡¶ø‡¶Ç ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á) ‚Äì ${amount} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ã‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø`,

        ep_table_title: "‡¶∏‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶® - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ",
        db_table_title: "‡¶°‡¶ø‡¶ï‡ßç‡¶≤‡¶æ‡¶á‡¶®‡¶ø‡¶Ç ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ",

        btn_calculate: "‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®",

        table_ep: ["‡¶Æ‡¶æ‡¶∏","‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®","‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®","‡¶∂‡ßá‡¶∑ ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®","‡¶∏‡ßÅ‡¶¶","‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßÅ‡¶¶","‡¶∏‡¶Æ‡¶∑‡ßç‡¶ü‡¶ø‡¶ó‡¶§ ‡¶∏‡ßÅ‡¶¶","‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü"],
        table_db: ["‡¶Æ‡¶æ‡¶∏","‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®","‡¶á‡¶è‡¶Æ‡¶Ü‡¶á","‡¶∏‡ßÅ‡¶¶","‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®","‡¶∂‡ßá‡¶∑"],

        risk_very_high: pct => 
            `‚ö† <b>‡¶Ö‡¶§‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£!</b> ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø‡¶∞ ‡¶™‡¶∞‡ßá ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ <b>${pct}%</b> ‡¶¨‡ßá‡¶§‡¶® ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡ßá‡•§`,
        risk_high: pct => 
            `‚ö† <b>‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø ‡¶∞‡ßü‡ßá‡¶õ‡ßá!</b> ‡¶π‡¶æ‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡ßá ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ <b>${pct}%</b> ‚Äî ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡ßü ‡¶ï‡¶†‡¶ø‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§`,
        risk_medium: pct =>
            `‚úî <b>‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø</b> ‚Äî ‡¶π‡¶æ‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡ßá <b>${pct}%</b> ‡¶§‡¶¨‡ßá ‡¶∏‡¶û‡ßç‡¶ö‡ßü ‡¶ï‡¶Æ ‡¶π‡¶¨‡ßá‡•§`,
        risk_low: pct =>
            `‚úî <b>‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§!</b> ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø‡¶∞ ‡¶™‡¶∞ ‡¶π‡¶æ‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡ßá <b>${pct}%</b> ‡¶¨‡ßá‡¶§‡¶®‡•§`
    },

    en: {
        title: "Loan EMI & Eligibility Calculator",
        inputTitle: "Loan Information",

        borrower: "Borrower Name",
        amount: "Loan Amount",
        months: "Duration (Months)",
        rate: "Rate of Interest (%)",
        salary: "Monthly Net Salary",
        salaryPercent: "What % of Salary Allowed?",
        
        ph_borrower: "Enter name",
        ph_amount: "100000",
        ph_months: "60",
        ph_rate: "13.40",
        ph_salary: "0",
        ph_salaryPercent: "80",

        ep_title: amount => `Loan Summary (Equal Principal) ‚Äì For ${amount} Tk`,
        db_title: amount => `Loan Summary (Declining EMI) ‚Äì For ${amount} Tk`,

        ep_table_title: "Equal Principal ‚Äì Detailed EMI Schedule",
        db_table_title: "Declining EMI ‚Äì Schedule",

        btn_calculate: "Calculate",

        table_ep: ["Month","Opening","Principal","Closing","Interest","Monthly Interest","Cumulative","Balance"],
        table_db: ["Month","Opening","EMI","Interest","Principal","Closing"],

        risk_very_high: pct =>
            `‚ö† <b>Very High Risk!</b> Only <b>${pct}%</b> income remains.`,
        risk_high: pct =>
            `‚ö† <b>Risky!</b> Only <b>${pct}%</b> income remains after EMI.`,
        risk_medium: pct =>
            `‚úî <b>Acceptable</b> ‚Äî <b>${pct}%</b> income remains.`,
        risk_low: pct =>
            `‚úî <b>Safe!</b> A healthy <b>${pct}%</b> income remains.`
    }
};

/* ===========================================================
      AUTO LANGUAGE DETECT + USER PREFERENCE
=========================================================== */
let currentLang = localStorage.getItem("emiLang");

if (!currentLang) {
    const browserLang = navigator.language.startsWith("bn") ? "bn" : "en";
    currentLang = browserLang;
    localStorage.setItem("emiLang", currentLang);
}

/* ===========================================================
      APPLY LANGUAGE TO UI
=========================================================== */
function applyLang() {

    const L = lang[currentLang];

    document.getElementById("mainTitle").innerText = L.title;
    document.getElementById("inputTitle").innerText = L.inputTitle;

    document.getElementById("lblBorrower").innerText = L.borrower;
    document.getElementById("lblAmount").innerText = L.amount;
    document.getElementById("lblMonths").innerText = L.months;
    document.getElementById("lblRate").innerText = L.rate;
    document.getElementById("lblSalary").innerText = L.salary;
    document.getElementById("lblSalaryPercent").innerText = L.salaryPercent;

    document.getElementById("name").placeholder = L.ph_borrower;
    document.getElementById("loan").placeholder = L.ph_amount;
    document.getElementById("months").placeholder = L.ph_months;
    document.getElementById("rate").placeholder = L.ph_rate;
    document.getElementById("salary").placeholder = L.ph_salary;
    document.getElementById("salaryPercent").placeholder = L.ph_salaryPercent;

    document.querySelector("#inputSection button").innerText = L.btn_calculate;
}

/* Apply it once page loads */
applyLang();

/* Language buttons */
document.getElementById("lang-bn").onclick = () => {
    currentLang = "bn";
    localStorage.setItem("emiLang","bn");
    applyLang();
};
document.getElementById("lang-en").onclick = () => {
    currentLang = "en";
    localStorage.setItem("emiLang","en");
    applyLang();
};

/* ===========================================================
      HELPER FUNCTIONS
=========================================================== */
function num(id){
    let v = document.getElementById(id).value.trim()
            || document.getElementById(id).placeholder.trim();
    return parseFloat(v) || 0;
}
function format(n){
    return Number(n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});
}

/* Theme Switcher */
document.getElementById("theme-light").onclick = ()=> document.body.className="theme-light";
document.getElementById("theme-business").onclick = ()=> document.body.className="theme-business";
document.getElementById("theme-print").onclick = ()=> document.body.className="theme-printlike";

/* ===========================================================
      SMART RISK MESSAGE
=========================================================== */
function smartMessage(salaryPortion, monthlyInstall){

    const L = lang[currentLang];
    let remaining = salaryPortion - monthlyInstall;
    let pct = ((remaining / salaryPortion) * 100).toFixed(1);

    if (pct < 5)  return `<div class="alert-custom">${L.risk_very_high(pct)}</div>`;
    if (pct < 15) return `<div class="alert-custom">${L.risk_high(pct)}</div>`;
    if (pct < 30) return `<div class="alert-success-custom">${L.risk_medium(pct)}</div>`;
    
    return `<div class="alert-success-custom">${L.risk_low(pct)}</div>`;
}

/* ===========================================================
      MAIN CALCULATION WRAPPER
=========================================================== */
let chartEP = null;

function calculateAll() {

    let name = document.getElementById("name").value;
    let loan = num("loan");
    let months = num("months");
    let rate = num("rate")/100;
    let salary = num("salary");
    let salaryPercent = num("salaryPercent") || 80;

    let salaryPortion = salary * (salaryPercent/100);
    let r = (rate/12)*1.016666667;

    calcEP(name, loan, months, salaryPortion, salaryPercent, r);
    calcDB(name, loan, months, salaryPortion, salaryPercent, r);

    document.getElementById("actions").style.display = "block";
}

/* ===========================================================
      EQUAL PRINCIPAL EMI
=========================================================== */
function calcEP(name, loan, months, salaryPortion, salaryPercent, r){

    const L = lang[currentLang];

    let principal = loan/months;
    let bal = loan;
    let totalInterest = 0;
    let data = [];

    for(let m=1;m<=months;m++){
        let interest = bal * r;
        totalInterest += interest;
        let close = bal - principal;
        data.push({month:m, open:bal, principal, close, interest});
        bal = close;
    }

    let monthlyInterest = totalInterest/months;
    let monthlyInstall = principal + monthlyInterest;

    /* Summary */
    let header = L.ep_title(format(loan));

    document.getElementById("results-ep").innerHTML = `
    <div class="card p-4 mb-3">

        <h3 class="fw-bold">${header}</h3>

        <div class="row mt-3">

            <div class="col-md-4">
                <p><strong>${L.borrower}:</strong> ${name || "N/A"}</p>
                <p><strong>${L.salaryPercent}:</strong> ${format(salaryPortion)}</p>
                <p><strong>Principal/month:</strong> ${format(principal)}</p>
            </div>

            <div class="col-md-4">
                <p><strong>Total Interest:</strong> ${format(totalInterest)}</p>
                <p><strong>Interest/month:</strong> ${format(monthlyInterest)}</p>
                <p><strong>Installment:</strong> ${format(monthlyInstall)}</p>
            </div>

            <div class="col-md-4 text-center">
                <div class="qr-box" id="qrEP"></div>
            </div>

        </div>

        <div class="mt-3">${ smartMessage(salaryPortion, monthlyInstall) }</div>
    </div>`;

    /* QR Code */
    new QRCode(document.getElementById("qrEP"),{
        text:"https://www.ablatif.com/emi/loan_emi_full.html",
        width:120, height:120
    });

    /* GRAPH */
    const labels = data.map(r=>r.month);
    const interestData = data.map(r=>r.interest);
    const principalData = data.map(r=>r.principal);

    if(chartEP) chartEP.destroy();

    document.getElementById("chartContainerEP").style.display="block";

    chartEP = new Chart(document.getElementById("emiChartEP"),{
        type:"line",
        data:{
            labels,
            datasets:[
                { label:(currentLang==="bn"?"‡¶∏‡ßÅ‡¶¶":"Interest"), data:interestData, borderColor:"red", borderWidth:2, tension:0.25 },
                { label:(currentLang==="bn"?"‡¶Æ‡ßÇ‡¶≤‡¶ß‡¶®":"Principal"), data:principalData, borderColor:"green", borderWidth:2, tension:0.25 }
            ]
        },
        options:{ responsive:true, maintainAspectRatio:false }
    });

    /* TABLE */
    let rows = "", cumulative = 0;

    for(let d of data){
        cumulative += d.interest;
        let balInt = cumulative - (monthlyInterest * d.month);

        rows += `
        <tr>
            <td>${d.month}</td>
            <td>${format(d.open)}</td>
            <td>${format(d.principal)}</td>
            <td>${format(d.close)}</td>
            <td>${format(d.interest)}</td>
            <td>${format(monthlyInterest)}</td>
            <td>${format(cumulative)}</td>
            <td>${format(balInt)}</td>
        </tr>`;
    }

    let th = L.table_ep.map(c=>`<th>${c}</th>`).join("");

    document.getElementById("schedule-ep").innerHTML = `
    <div class="card p-4 page-break">

        <h4 class="fw-bold">${L.ep_table_title}</h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered table-striped">
                <thead><tr>${th}</tr></thead>
                <tbody>${rows}</tbody>
            </table>
        </div>

    </div>`;
}

/* ===========================================================
      DECLINING EMI
=========================================================== */
function calcDB(name,loan,months,salaryPortion,salaryPercent,r){

    const L = lang[currentLang];

    let emi = loan*r*Math.pow(1+r,months)/(Math.pow(1+r,months)-1);
    let bal=loan, rows="", totalInterest=0;

    for(let m=1;m<=months;m++){
        let interest = bal*r;
        let principal = emi - interest;
        let close = bal - principal;
        totalInterest += interest;

        rows+=`
        <tr>
            <td>${m}</td>
            <td>${format(bal)}</td>
            <td>${format(emi)}</td>
            <td>${format(interest)}</td>
            <td>${format(principal)}</td>
            <td>${format(close)}</td>
        </tr>`;

        bal = close;
    }

    let header = L.db_title(format(loan));

    document.getElementById("results-db").innerHTML = `
    <div class="card p-4 mb-3">
        <h3 class="fw-bold">${header}</h3>

        <div class="row mt-3">
            <div class="col-md-4">
                <p><strong>${L.borrower}:</strong> ${name}</p>
                <p><strong>${L.salaryPercent}:</strong> ${format(salaryPortion)}</p>
                <p><strong>${L.months}:</strong> ${months}</p>
            </div>

            <div class="col-md-4">
                <p><strong>EMI:</strong> ${format(emi)}</p>
                <p><strong>Total Interest:</strong> ${format(totalInterest)}</p>
            </div>

            <div class="col-md-4"></div>
        </div>

        <div class="mt-3">${ smartMessage(salaryPortion, emi) }</div>

    </div>`;

    /* TABLE */
    let th = L.table_db.map(c=>`<th>${c}</th>`).join("");

    document.getElementById("schedule-db").innerHTML = `
    <div class="card p-4 page-break">

        <h4 class="fw-bold">${L.db_table_title}</h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered">
                <thead><tr>${th}</tr></thead>
                <tbody>${rows}</tbody>
            </table>
        </div>

    </div>`;
}

</script>
